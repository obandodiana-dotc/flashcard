<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trivoca AI v4.4 ‚Äî Flashcards Minimal</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß†</text></svg>">
<style>
:root {
  --bg: #fefefe;
  --panel: #ffffff;
  --accent: #4f46e5;
  --muted: #6b7280;
  --soft: #e0e7ff;
  --success: #10b981;
  --danger: #ef4444;
  --card-radius: 16px;
  --shadow: 0 10px 25px rgba(0,0,0,0.08);
  --mono: 'Inter', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
}

*{box-sizing:border-box;font-family:var(--mono);}
html,body{margin:0;height:100%;background:var(--bg);color:var(--accent);}
.wrap{min-height:100vh;padding:30px;display:flex;justify-content:center;align-items:flex-start;}
.app{display:grid;grid-template-columns:380px 1fr;gap:24px;width:100%;max-width:1200px;}

.panel{background:var(--panel);border-radius:var(--card-radius);padding:20px;box-shadow:var(--shadow);}
h2{margin:0 0 10px 0;font-size:22px;}
label{display:block;margin-top:12px;font-size:13px;color:var(--muted);}
.trans-optional-message{display:none;color:var(--muted);}
.list-empty-message{text-align:center;color:var(--muted);margin-top:10px;}

input, select, textarea{
  width:100%;padding:10px;border-radius:12px;border:1px solid var(--soft);margin-top:6px;font-size:14px;
  transition:border-color 0.2s ease,box-shadow 0.2s ease;
}
input:focus, select:focus, textarea:focus{
  outline:none;
  border-color: var(--accent);
  box-shadow:0 0 0 3px rgba(79,70,229,0.2);
}
.btn{
  background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:12px;cursor:pointer;
  transition:0.3s;font-weight:600;margin-top:10px;
}
.btn:hover, .btn:focus{opacity:0.9;outline:2px solid var(--accent);outline-offset:2px;}
.btn.ghost{background:transparent;border:1px solid var(--soft);color:var(--muted);}
.btn.ghost:hover, .btn.ghost:focus{background:var(--soft);outline:2px solid var(--muted);}

.list{margin-top:12px;max-height:320px;overflow-y:auto;padding:0;list-style:none;}
.list-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:12px;border:1px solid var(--soft);margin-bottom:8px;background:var(--soft);font-size:14px;transition:0.2s;}
.list-item:hover{background:#dbeafe;}
.list-item button{margin-left:10px;padding:8px 12px;font-size:13px;border-radius:8px;background:var(--accent);color:#fff;border:none;cursor:pointer;transition:0.2s;}
.list-item button:hover{opacity:0.9;}

.flashcard{
  background:var(--panel);border-radius:var(--card-radius);box-shadow:var(--shadow);
  display:flex;gap:20px;padding:20px;align-items:center;transition:all 0.4s ease-in-out;
  min-height:380px; transform: translateY(0); 
}
.flashcard.show{transform: translateY(-10px);}
.flash-left{flex:1;display:flex;flex-direction:column;}
.flash-right{flex:1;display:flex;align-items:center;justify-content:center;}
.word{font-size:36px;font-weight:800;margin-bottom:4px;}
.translation{font-size:22px;color:var(--muted);}
.image-box{width:100%;height:200px;border-radius:12px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;overflow:hidden;margin-bottom:10px;transition:0.3s;}
.image-box img{width:100%;height:100%;object-fit:cover;transition:0.3s;}
.example{background:#f9fafb;border-radius:10px;padding:10px;margin-top:10px;border:1px dashed var(--soft);color:var(--muted);font-size:14px;min-height:40px;}
.controls{display:flex;gap:10px;align-items:center;margin-top:12px;}
@media (max-width:1000px){.app{grid-template-columns:1fr;}.flash-right{display:none;}.wrap{padding:20px;}}
</style>
</head>
<body>
<div class="wrap">
  <div class="app">
    <aside class="panel">
      <h2>Trivoca AI v4.4</h2>

      <label for="originLang">Idioma origen</label>
      <select id="originLang">
        <option value="en">Ingl√©s</option>
        <option value="de">Alem√°n</option>
      </select>

      <label for="wordInput">Palabra</label>
      <input id="wordInput" placeholder="Ej. Apfel / Apple">

      <label for="transInput">Traducci√≥n (Espa√±ol)</label>
      <input id="transInput" aria-describedby="trans-optional" placeholder="Opcional">
      <p id="trans-optional" class="trans-optional-message">Este campo es opcional y se puede rellenar autom√°ticamente.</p>

      <label for="themeSelect">Tema</label>
      <select id="themeSelect">
        <option value="general">General</option>
        <option value="food">Comida</option>
        <option value="travel">Viajes</option>
        <option value="work">Trabajo</option>
        <option value="home">Hogar</option>
      </select>

      <div class="controls">
        <button class="btn" id="addBtn" aria-label="A√±adir tarjeta de vocabulario">A√±adir</button>
        <button class="btn ghost" id="aiBtn" aria-label="Generar traducci√≥n y ejemplo con IA">AI Assist</button>
      </div>

      <label for="search">Buscar</label>
      <input id="search" placeholder="Filtrar por palabra o traducci√≥n">

      <ul class="list" id="cardsList" role="list"></ul>
      <p id="listEmptyMessage" class="list-empty-message">A√±ade tu primera tarjeta.</p>
    </aside>

    <main class="panel">
      <div class="flashcard" id="flashcard">
        <div class="flash-left">
          <div class="word" id="displayWord" aria-live="polite">---</div>
          <div class="translation" id="displayTrans">---</div>
          <div class="example" id="exampleText">Ejemplo aparecer√° aqu√≠.</div>
          <button class="btn ghost" id="speakBtn" aria-label="Reproducir pronunciaci√≥n">üîä Pronunciaci√≥n</button>
        </div>
        <div class="flash-right">
          <div class="image-box"><img id="wordImage" src="" alt="Imagen de la palabra"></div>
        </div>
      </div>
    </main>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);
const wordInput = $('wordInput');
const transInput = $('transInput');
const originLang = $('originLang');
const themeSelect = $('themeSelect');
const addBtn = $('addBtn');
const aiBtn = $('aiBtn');
const cardsList = $('cardsList');
const searchInput = $('search');
const displayWord = $('displayWord');
const displayTrans = $('displayTrans');
const exampleText = $('exampleText');
const wordImage = $('wordImage');
const speakBtn = $('speakBtn');
const listEmptyMessage = $('listEmptyMessage');
const flashcardEl = $('flashcard');

let flashcards = [];
try { flashcards = JSON.parse(localStorage.getItem('flashcards')) || []; } 
catch(e){ flashcards=[]; console.warn("LocalStorage corrupto."); }
let currentIndex = flashcards.length>0?0:-1;

const themeImages = {
  food:'https://source.unsplash.com/400x200/?food',
  travel:'https://source.unsplash.com/400x200/?travel',
  work:'https://source.unsplash.com/400x200/?office',
  home:'https://source.unsplash.com/400x200/?home',
  general:'https://source.unsplash.com/400x200/?nature'
};

function saveFlashcards(){ localStorage.setItem('flashcards',JSON.stringify(flashcards)); }

function addCard(word,trans,lang,theme){
  const trimmedWord = word.trim(); if(!trimmedWord){alert("‚ö†Ô∏è Ingresa una palabra.");return;}
  const finalTrans = trans.trim()||`Traducci√≥n de "${trimmedWord}" (AI Assist)`;
  const id = Date.now();
  flashcards.push({id,word:trimmedWord,trans:finalTrans,lang,theme});
  saveFlashcards(); updateList(); showCardById(id);
  wordInput.value=""; transInput.value="";
}

function updateList(){
  cardsList.innerHTML="";
  if(flashcards.length===0){ listEmptyMessage.style.display='block'; return;} else {listEmptyMessage.style.display='none';}
  flashcards.forEach(c=>{
    const li=document.createElement('li'); li.className='list-item'; li.setAttribute('role','listitem');
    li.innerHTML=`<span>${c.word} ‚Üí ${c.trans}</span>`;
    const btn=document.createElement('button'); btn.textContent='Ver'; btn.setAttribute('aria-label',`Ver tarjeta ${c.word}`);
    btn.addEventListener('click',()=>showCardById(c.id));
    li.appendChild(btn); cardsList.appendChild(li);
  });
}

function showCardById(id){
  const c=flashcards.find(f=>f.id===id);
  if(!c){ displayWord.textContent='---'; displayTrans.textContent='---'; exampleText.textContent='Ejemplo aparecer√° aqu√≠.'; wordImage.src=''; wordImage.alt='Imagen de la palabra'; return;}
  currentIndex = flashcards.indexOf(c);
  displayWord.textContent=c.word; displayTrans.textContent=c.trans;
  exampleText.innerHTML=generateExample(c.word,c.trans,c.lang);
  wordImage.src=`https://source.unsplash.com/400x200/?${encodeURIComponent(c.word)},${c.theme}`;
  wordImage.onerror=()=>{ wordImage.src=themeImages[c.theme]||themeImages.general; }
  wordImage.alt=`Imagen relacionada con la palabra: ${c.word}`;
  flashcardEl.classList.add('show'); setTimeout(()=>flashcardEl.classList.remove('show'),400);
}

function generateExample(word,trans,lang){
  if(lang==='de') return `Ich sehe ein <strong>${word}</strong> jeden Tag. (Traducci√≥n: ${trans})`;
  if(lang==='en') return `I see a <strong>${word}</strong> every day. (Traducci√≥n: ${trans})`;
  return `No hay ejemplo. Palabra: ${

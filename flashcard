<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Plan de 1 Mes para Aprender Alem√°n (A1) ‚ú® - D√≠a a D√≠a</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --pink-500: #ec4899;
            --pink-200: #fbcfe8;
            --pink-50: #fdf2f8;
            --grad-from: #f472b6;
            --grad-to: #a855f7;
        }
        body { font-family: 'Inter', sans-serif; background: #f8fafc; }
        .font-display { font-family: 'Dancing Script', cursive; }
        .stat-card {
            background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .checkbox-wrap { position: relative; padding-left: 2.1rem; display: inline-flex; align-items: center; cursor: pointer; }
        .checkbox-wrap input[type="checkbox"] { position: absolute; left: 0; top: 0.12rem; width: 1.25rem; height: 1.25rem; opacity: 0; }
        .checkbox-box {
            position: absolute; left: 0; top: 0.12rem; width: 1.25rem; height: 1.25rem;
            border: 2px solid var(--pink-200); border-radius: .25rem; display: inline-flex; align-items:center; justify-content:center;
            transition: all .18s; background: white;
        }
        .checkbox-box .tick { font-size: 1rem; color: white; opacity: 0; transition: opacity .15s; line-height: 1; }
        input[type="checkbox"]:checked + .checkbox-box { background: var(--pink-500); border-color: var(--pink-500); }
        input[type="checkbox"]:checked + .checkbox-box .tick { opacity: 1; }
        .task-done { text-decoration: line-through; color: #6b7280; }
        .modal { transition: opacity .25s, transform .25s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); }
        }
        .shake-anim { animation: shake 0.3s ease-in-out; }
        .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Estilos de Pesta√±as y Contenido */
        .tab-button.active {
            background-color: white; color: var(--pink-500); font-weight: 600; border-bottom-color: white;
        }
        .tab-button {
            background-color: #f3f4f6; border-color: #e5e7eb; transition: background-color 0.15s; border-bottom: 2px solid var(--pink-500);
            flex: 1 1 0%; text-align: center;
        }
        .lesson-content h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1rem; margin-bottom: 0.5rem; color: #a855f7; }
        .lesson-content strong { font-weight: 700; color: #ec4899; }
        .lesson-content p { margin-bottom: 0.75rem; line-height: 1.5; }
        
        /* Adaptaciones Adicionales para M√≥vil */
        #reminderList { max-height: 200px; overflow-y: auto; }
        .modal { max-width: 90%; }
        /* Para evitar el colapso de los botones del modal en m√≥viles */
        #answerView .control-group { 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
        }
        @media (min-width: 640px) { /* sm breakpoint */
            #answerView .control-group { 
                flex-direction: row; 
                justify-content: space-between;
                align-items: center;
            }
        }
    </style>
</head>
<body class="min-h-screen">

    <header class="bg-gradient-to-r from-[var(--grad-from)] to-[var(--grad-to)] text-white p-6 shadow-lg">
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-6">
                <div class="flex-1 text-left">
                    <h1 class="text-3xl font-display leading-tight">Tu Plan de Alem√°n</h1>
                    <p class="text-sm opacity-90">(Nivel A1)</p>
                </div>
                <button id="openReminderModalBtn" class="p-2 ml-4 rounded-full hover:bg-white/20 transition flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" /></svg>
                </button>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                <div class="stat-card rounded-xl p-4 flex items-center gap-4">
                    <div class="p-2 bg-white/30 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" /></svg></div>
                    <div><span class="text-xs opacity-80">D√≠a del Plan</span><div id="headerDayDisplay" class="text-xl font-bold">D√≠a 1 / 30</div></div>
                </div>
                <div class="stat-card rounded-xl p-4 flex items-center gap-4">
                    <div class="p-2 bg-white/30 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6a8.983 8.983 0 013.361-6.867 8.21 8.21 0 003 2.48z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 18a3.75 3.75 0 00.495-7.467 5.99 5.99 0 00-1.925 3.546 5.974 5.974 0 01-2.133-1A3.75 3.75 0 0012 18z" /></svg></div>
                    <div><span class="text-xs opacity-80">Racha Actual</span><div id="streak" class="text-xl font-bold">0 D√≠as üî•</div></div>
                </div>
                <div class="stat-card rounded-xl p-4">
                    <div class="flex justify-between items-center mb-2"><span class="text-xs opacity-80">Progreso Total</span><span id="progressPercent" class="text-xl font-bold">0%</span></div>
                    <div class="w-full bg-white/30 rounded-full h-2"><div id="progressBar" class="bg-white h-2 rounded-full transition-all duration-300" style="width: 0%"></div></div>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-4xl mx-auto p-4 sm:p-6">
        
        <section id="openWordOfDayCard" class="bg-white rounded-xl p-4 shadow-sm mb-6 cursor-pointer hover:shadow-lg transition">
            <h2 id="wodTitle" class="font-semibold text-gray-700 mb-2 text-sm">Wort des Tages (Palabra del D√≠a)</h2>
            <div class="flex justify-between items-end">
                <div><h3 id="wodWord" class="text-2xl sm:text-3xl font-bold text-gray-900">die Woche</h3><p id="wodPlural" class="text-sm text-gray-500 mt-1">Plural: die Wochen</p></div>
                <span id="wodTranslation" class="text-base sm:text-lg font-semibold text-pink-600">la semana</span>
            </div>
        </section>

        <div class="flex flex-col md:flex-row items-center justify-between gap-4 mb-4">
            <div class="flex items-center gap-3 w-full md:w-auto">
                <select id="jumpDay" class="rounded-md px-3 py-2 bg-white shadow-sm text-sm border border-gray-200 w-full"><option value="">Ir a d√≠a...</option></select>
                <button id="goDay" class="px-3 py-2 rounded-md bg-pink-100 text-pink-700 text-sm flex-shrink-0">Ir</button>
            </div>
            <button id="resetProgress" class="px-3 py-2 rounded-md bg-white shadow-sm text-sm text-red-600 border border-gray-200 w-full md:w-auto">Reset progreso</button>
        </div>

        <div class="flex justify-between items-center mb-4 p-3 bg-white rounded-lg shadow-sm border border-gray-200">
            <button id="prevDayBtn" class="nav-btn px-3 py-2 rounded-md bg-gray-100 hover:bg-gray-200 text-xs sm:text-sm flex-1 mr-2">&lt; D√≠a Anterior</button>
            <div id="currentDayDisplay" class="text-base sm:text-lg font-semibold text-pink-600 text-center flex-1 mx-2">D√≠a X / 30</div>
            <button id="nextDayBtn" class="nav-btn px-3 py-2 rounded-md bg-gray-100 hover:bg-gray-200 text-xs sm:text-sm flex-1 ml-2">D√≠a Siguiente &gt;</button>
        </div>

        <main id="daysContainer" class="mb-8"></main> 
        
        <section class="bg-white rounded-2xl p-4 shadow-sm border border-gray-200">
            <div class="flex flex-wrap items-center justify-between mb-3 gap-2">
                <h2 class="font-semibold text-lg text-pink-600">üìù Diario (D√≠a <span id="journalCurrentDay">1</span>)</h2>
                <div class="flex items-center gap-2 flex-shrink-0">
                    <label for="journalDay" class="text-sm text-gray-600">D√≠a:</label>
                    <select id="journalDay" class="rounded-md px-2 py-1 bg-gray-50 border border-gray-200 text-sm"></select>
                </div>
            </div>
            <textarea id="journalText" rows="6" class="journal-textarea w-full p-3 rounded-md border border-gray-200 bg-white" placeholder="Escribe tus frases..."></textarea>
            
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mt-3">
                <p id="autosaveNotice" class="text-xs text-gray-500 order-last sm:order-first w-full sm:w-auto">Guardado autom√°tico activo.</p>
                <div class="flex gap-2 justify-end w-full sm:w-auto flex-wrap">
                    <button id="saveJournal" class="flex-1 min-w-[45%] sm:min-w-0 px-3 py-2 rounded-md bg-pink-600 text-white text-sm">Guardar</button>
                    <button id="exportState" class="flex-1 min-w-[45%] sm:min-w-0 px-3 py-2 rounded-md bg-white text-sm shadow-sm border border-gray-200">Exportar</button>
                    <button id="importStateBtn" class="flex-1 min-w-[45%] sm:min-w-0 px-3 py-2 rounded-md bg-white text-sm shadow-sm border border-gray-200">Importar</button>
                    <input id="importFile" type="file" accept="application/json" class="hidden">
                </div>
            </div>
        </section>
    </div>

    <div id="modalBackdrop" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-40 p-4">
        <div id="modal" class="modal bg-white rounded-2xl p-6 max-w-lg w-full shadow-lg transform">
            <h3 id="modalTitle" class="text-xl font-semibold text-pink-600 mb-4"></h3>
            
            <div id="preTestView" class="hidden">
                <p class="text-gray-700 mb-4 text-sm">¬°Bienvenido! Antes de empezar, completa este test r√°pido (5 preguntas) para verificar tu nivel. Podr√≠as saltarte los primeros d√≠as.</p>
                <div id="preTestContainer" class="space-y-4 max-h-96 overflow-y-auto pr-1">
                    </div>
                <div id="preTestFeedback" class="text-sm text-red-500 my-3 h-4"></div>
                <button id="submitPreTestBtn" class="w-full px-4 py-3 rounded-md bg-pink-600 text-white mt-4 hover:bg-pink-700 transition">Comenzar Plan</button>
            </div>

            <div id="quizView" class="hidden">
                <p id="quizQuestion" class="text-gray-700 mb-4 text-lg">¬øC√≥mo se dice...? <strong id="quizWordTrans"></strong></p>
                <input id="quizInput" type="text" class="w-full p-2 border border-gray-300 rounded-md mb-3" placeholder="Escribe en alem√°n...">
                <div id="quizFeedback" class="text-sm text-red-500 mb-3 h-4"></div>
                <div class="flex justify-between">
                    <button id="revealAnswerBtn" class="px-3 py-2 rounded-md bg-gray-100 text-sm">Revelar</button>
                    <button id="checkAnswerBtn" class="px-4 py-2 rounded-md bg-pink-600 text-white">Comprobar</button>
                </div>
            </div>
            
            <div id="answerView" class="hidden">
                <p id="modalMessage" class="text-gray-700 mb-4"></p>
                <div class="mb-4 p-3 bg-gray-50 rounded-md border border-gray-200">
                    <p class="text-sm text-gray-600 font-medium">Ejemplo:</p>
                    <p id="modalExampleSentence" class="text-sm text-gray-800 italic"></p>
                    <p id="modalExampleTranslation" class="text-xs text-gray-500 italic mt-1"></p>
                </div>
                <div id="modalExample" class="text-sm text-gray-500 mb-4"></div> 
                
                <div class="control-group">
                    <div class="flex gap-2">
                        <button id="listenWordBtn" class="px-3 py-2 rounded-md bg-blue-100 text-blue-700 text-sm">üó£Ô∏è Palabra</button>
                        <button id="listenExampleBtn" class="px-3 py-2 rounded-md bg-blue-100 text-blue-700 text-sm">üó£Ô∏è Ejemplo</button>
                    </div>
                    <div class="flex gap-2 w-full sm:w-auto">
                        <button id="prevWord" class="px-3 py-2 rounded-md bg-gray-100 text-sm flex-1">Anterior</button>
                        <button id="nextWord" class="px-3 py-2 rounded-md bg-gray-100 text-sm flex-1">Siguiente</button>
                        <button id="closeModal" class="px-4 py-2 rounded-md bg-pink-600 text-white text-sm flex-1">Cerrar</button>
                    </div>
                </div>
            </div>

            <div id="greetingView" class="hidden">
                <p id="greetingMessage" class="text-gray-700 mb-4 text-lg"></p><button id="closeGreetingBtn" class="w-full px-4 py-2 rounded-md bg-pink-600 text-white">¬°Vamos!</button>
            </div>

            <div id="reminderView" class="hidden">
                <p class="text-gray-700 mb-4 text-sm">Crea una nota r√°pida o un recordatorio (solo local):</p>
                <textarea id="reminderInput" rows="3" class="w-full p-2 border border-gray-300 rounded-md mb-3" placeholder="Ej: Repasar los art√≠culos del D√çA 9 ma√±ana"></textarea>
                <button id="addReminderBtn" class="px-3 py-2 rounded-md bg-pink-600 text-white text-sm mb-4 w-full font-medium hover:bg-pink-700 transition">A√±adir Nota</button>
                <h4 class="font-semibold text-gray-700 mb-2 border-t pt-3">Mis Notas:</h4>
                <ul id="reminderList" class="space-y-2 max-h-40 overflow-y-auto pr-1"> 
                    <li class="text-gray-500 italic text-sm">No hay notas guardadas.</li>
                </ul>
                <button id="closeReminderModal" class="mt-4 w-full px-4 py-2 rounded-md bg-gray-200 text-gray-700 text-sm hover:bg-gray-300 transition">Cerrar</button>
            </div>

            <div id="confidenceView" class="hidden text-center">
                <p class="text-gray-700 mb-6 text-lg font-medium">¬øQu√© tan seguro/a est√°s de haber dominado esta tarea?</p>
                <div class="flex justify-around items-center gap-4">
                    <button data-level="1" class="confidence-btn p-3 rounded-full text-4xl sm:text-5xl bg-red-100 border border-red-300">üôÅ</button>
                    <button data-level="2" class="confidence-btn p-3 rounded-full text-4xl sm:text-5xl bg-yellow-100 border border-yellow-300">üòê</button>
                    <button data-level="3" class="confidence-btn p-3 rounded-full text-4xl sm:text-5xl bg-green-100 border border-green-300">üòÑ</button>
                </div>
                <p class="text-sm text-gray-500 mt-2">Baja (1) - Media (2) - Alta (3)</p>
                <p class="text-xs text-pink-600 mt-4 font-medium">Las tareas con confianza baja ser√°n priorizadas en futuros repasos.</p>
            </div>

        </div>
    </div>

    <template id="day-template">
        <article class="bg-white rounded-2xl p-4 shadow-sm border border-gray-200">
            <header class="flex flex-col md:flex-row items-start md:items-center justify-between">
                <div>
                    <h3 class="text-lg font-semibold text-pink-600 day-title">üìÖ D√≠a X: T√≠tulo</h3>
                    <p class="text-xs text-gray-500 day-word">Palabra clave: <strong>palabra</strong></p>
                </div>
                <div class="flex items-center gap-2 mt-2 md:mt-0">
                    <div class="text-sm text-gray-600 mr-2 day-status"></div>
                </div>
            </header>
            
            <div class="mt-3 border-b border-gray-200">
                <div class="flex">
                    <button data-tab="lesson" class="tab-button px-4 py-2 text-sm text-gray-600 rounded-t-lg border border-b-0 border-gray-200 -mb-px active">
                        Clase del D√≠a üìñ
                    </button>
                    <button data-tab="tasks" class="tab-button px-4 py-2 text-sm text-gray-600 rounded-t-lg border border-b-0 border-gray-200 -mb-px ml-1">
                        Pr√°ctica y Tareas ‚úÖ
                    </button>
                </div>
            </div>

            <div class="tab-content lesson-tab pt-4 lesson-content">
            </div>
            
            <div class="tab-content tasks-tab pt-4 hidden">
                <div class="day-content open">
                    <ul class="space-y-2 task-list"></ul>
                    <button class="mt-3 px-3 py-2 bg-pink-100 text-pink-700 rounded-md text-sm journal-focus-btn">Escribir en el diario de este d√≠a</button>
                </div>
            </div>

        </article>
    </template>
    <template id="task-template">
        <li class="flex items-start gap-3 p-3 rounded-lg task-item">
            <label class="checkbox-wrap w-full">
                <input type="checkbox" class="task-checkbox">
                <span class="checkbox-box"><span class="tick">‚úì</span></span>
                <span class="ml-3 text-sm task-label">
                    <span class="task-icon">üß†</span>
                    <span class="task-desc">Descripci√≥n de la tarea</span>
                    <span class="text-xs text-gray-500 task-time">(20 min)</span>
                </span>
            </label>
        </li>
    </template>

    <script>
        // L√ìGICA Y DATOS CORREGIDOS Y COMPLETADOS

        (function() {
            
            // --- DATOS DEL PRE-TEST ---
            const PRE_TEST_QUESTIONS = [
                { id: 1, question: "¬øC√≥mo se dice 'Yo soy espa√±ol'?", options: ['Ich habe Spanier', 'Ich bin Spanier', 'Du bist Spanier', 'Er ist Spanier'], answer: 'Ich bin Spanier' },
                { id: 2, question: "¬øCu√°l es el art√≠culo para 'Mesa' (*Tisch*)?", options: ['Die', 'Der', 'Das', 'Den'], answer: 'Der' },
                { id: 3, question: "¬øC√≥mo se pregunta '¬øDe d√≥nde viene usted?' (Formal)?", options: ['Wie hei√üt Sie?', 'Was machen Sie?', 'Woher kommen Sie?', 'Wo wohnst du?'], answer: 'Woher kommen Sie?' },
                { id: 4, question: "El plural de 'El coche' (*Das Auto*) es...", options: ['Die Autos', 'Die Auten', 'Die Autosse', 'Der Auto'], answer: 'Die Autos' },
                { id: 5, question: "La conjugaci√≥n correcta de *haben* (tener) para 'T√∫' (*Du*) es...", options: ['Du habe', 'Du hast', 'Du hat', 'Du haben'], answer: 'Du hast' },
            ];
            
            // --- DATOS DEL PLAN (COMPLETADOS HASTA EL D√çA 30) ---
            const PLAN_DIARIO = [
                { day: 1, word: 'Hallo', wordTrans: 'Hola', plural: 'Hallo', title: 'Saludos y Presentaciones', journalPrompt: 'Escribe 3 frases present√°ndote.', exampleSentence: 'Hallo, wie geht es Ihnen?', exampleTranslation: 'Hola, ¬øc√≥mo est√° usted?', learningGoals: ["Saludar y despedirse formal e informalmente.", "Presentarse (nombre).", "Preguntar '¬øC√≥mo est√°s?' y responder."], lessonContent: `<h3>Saludos B√°sicos (Gr√º√üe)</h3><p>La forma m√°s com√∫n y vers√°til de saludar es <strong>Hallo</strong> (Hola). Para ser m√°s espec√≠fico con el tiempo del d√≠a:</p><ul><li><strong>Guten Morgen!</strong> (Buenos d√≠as - hasta el mediod√≠a)</li><li><strong>Guten Tag!</strong> (Buen d√≠a - de mediod√≠a a tarde, el m√°s neutral)</li><li><strong>Guten Abend!</strong> (Buenas tardes/noches - a partir de las 6 PM)</li></ul><h3>Presentaciones y Formas de Cortes√≠a</h3><p>En alem√°n, la cortes√≠a es clave. Usamos <strong>Sie</strong> (Usted, formal) y <strong>du</strong> (t√∫, informal).</p><p>Para preguntar el nombre:</p><ul><li>Formal: <strong>Wie hei√üen Sie?</strong> (¬øC√≥mo se llama Usted?)</li><li>Informal: <strong>Wie hei√üt du?</strong> (¬øC√≥mo te llamas t√∫?)</li></ul><p>Para responder: <strong>Ich hei√üe [Tu Nombre].</strong> (Yo me llamo [Tu Nombre]).</p>`, tasks: [ { id:'d1-t1', icon:'üß†', color:'bg-pink-50', desc:'Vocabulario: Aprende 5 saludos y 3 despedidas.', time:'20 min' }, { id:'d1-t2', icon:'üéß', color:'bg-purple-50', desc:'Escucha un di√°logo "Hallo, wie geht\'s?" y repite.', time:'15 min' }, { id:'d1-t3', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 3 mini-di√°logos present√°ndote.', time:'15 min' } ] },
                { day: 2, word: 'die Woche', wordTrans: 'la semana', plural: 'die Wochen', title: 'Formal (Sie) vs. Informal (du)', journalPrompt: 'Escribe 2 frases formales y 2 informales.', exampleSentence: 'Diese Woche habe ich viel Arbeit.', exampleTranslation: 'Esta semana tengo mucho trabajo.', learningGoals: ["Diferenciar entre tratamiento formal (Sie) e informal (du).", "Usar las formas correctas al preguntar el nombre."], lessonContent: `<h3>El Dilema Sie vs. Du</h3><p>La elecci√≥n entre <strong>Sie (Usted)</strong> y <strong>du (t√∫)</strong> es crucial en Alemania. El error m√°s com√∫n de los principiantes es usar "du" con desconocidos o personas mayores.</p><ul><li><strong>Sie:</strong> Se usa con desconocidos, clientes, jefes, profesores y personas mayores (salvo que ellos te ofrezcan usar "du"). Siempre va con may√∫scula inicial.</li><li><strong>du:</strong> Se usa con amigos, familia, ni√±os y adolescentes, o si te lo han ofrecido expl√≠citamente ("Wir k√∂nnen uns duzen" / "Podemos tutearnos").</li></ul><h3>La Palabra del D√≠a: die Woche</h3><p>La palabra <strong>die Woche</strong> (la semana) es femenina, por lo que usa el art√≠culo femenino <strong>die</strong>. Su plural es <strong>die Wochen</strong>.</p><p>Aprender la palabra con el art√≠culo es vital: <strong>die Woche, die Wochen</strong>.</p>`, tasks: [ { id:'d2-t1', icon:'üß†', color:'bg-pink-50', desc:'Gram√°tica: Entiende la diferencia entre "Sie" (formal) y "du" (informal).', time:'15 min' }, { id:'d2-t2', icon:'üìñ', color:'bg-yellow-50', desc:'Lee ejemplos de "Wie hei√üen Sie?" vs. "Wie hei√üt du?".', time:'15 min' }, { id:'d2-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica presentarte de ambas formas en voz alta.', time:'15 min' } ] },
                { day: 3, word: 'sein', wordTrans: 'ser/estar', title: 'El Verbo "sein" (Ser/Estar)', journalPrompt: 'Escribe una frase con cada conjugaci√≥n de "sein".', exampleSentence: 'Ich bin m√ºde.', exampleTranslation: 'Estoy cansado/a.', learningGoals: ["Conjugar el verbo 'sein' (ser/estar) en presente.", "Formar frases b√°sicas usando 'sein' (nacionalidad, profesi√≥n, estado)."], lessonContent: `<h3>El Verbo Irregular m√°s Importante: sein</h3><p><strong>Sein</strong> (ser/estar) es irregular y fundamental. Debes memorizar estas conjugaciones, ya que se usa constantemente para indicar identidad, estado y ubicaci√≥n.</p><div class="p-3 bg-red-50 rounded-md font-mono text-sm"><p>Ich <strong>bin</strong> (Yo soy/estoy)</p><p>Du <strong>bist</strong> (T√∫ eres/est√°s)</p><p>Er/Sie/Es <strong>ist</strong> (√âl/Ella/Ello es/est√°)</p><p>Wir <strong>sind</strong> (Nosotros somos/estamos)</p><p>Ihr <strong>seid</strong> (Vosotros sois/est√°is)</p><p>Sie/sie <strong>sind</strong> (Usted/Ellos son/est√°n)</p></div><h3>Ejemplos de Uso</h3><ul><li>Nacionalidad: "Ich <strong>bin</strong> Spanier."</li><li>Estado: "Er <strong>ist</strong> gl√ºcklich."</li><li>Profesi√≥n: "Wir <strong>sind</strong> Studenten."</li></ul>`, tasks: [ { id:'d3-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Conjuga "sein" (ich bin, du bist, er/sie/es ist...).', time:'20 min' }, { id:'d3-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases usando "sein" (Ej: Ich bin m√ºde, Du bist nett).', time:'20 min' }, { id:'d3-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Di las conjugaciones de "sein" en voz alta 10 veces.', time:'10 min' } ] },
                { day: 4, word: 'haben', wordTrans: 'tener', title: 'El Verbo "haben" (Tener)', journalPrompt: 'Escribe 5 cosas que tienes.', exampleSentence: 'Wir haben Hunger.', exampleTranslation: 'Tenemos hambre.', learningGoals: ["Conjugar el verbo 'haben' (tener) en presente.", "Formar frases b√°sicas usando 'haben' (posesi√≥n, edad, sensaciones)."], lessonContent: `<h3>Conjugando el Verbo: haben</h3><p><strong>Haben</strong> (tener) tambi√©n es irregular, pero se usa para posesi√≥n y algunas expresiones de estado (como tener hambre o sed).</p><div class="p-3 bg-red-50 rounded-md font-mono text-sm"><p>Ich <strong>habe</strong> (Yo tengo)</p><p>Du <strong>hast</strong> (T√∫ tienes)</p><p>Er/Sie/Es <strong>hat</strong> (√âl/Ella/Ello tiene)</p><p>Wir <strong>haben</strong> (Nosotros tenemos)</p><p>Ihr <strong>habt</strong> (Vosotros ten√©is)</p><p>Sie/sie <strong>haben</strong> (Usted/Ellos tienen)</p></div><h3>Importante: haben vs. sein</h3><p>En alem√°n, las sensaciones (hambre, sed, sue√±o) se expresan con <strong>haben</strong> (tener), no con <strong>sein</strong> (estar), a diferencia del espa√±ol.</p><ul><li>Tener hambre: Ich <strong>habe</strong> Hunger.</li><li>Tener 30 a√±os: Er <strong>hat</strong> drei√üig Jahre.</li></ul>`, tasks: [ { id:'d4-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Conjuga "haben" (ich habe, du hast, er/sie/es hat...).', time:'20 min' }, { id:'d4-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases con "haben" (Ej: Ich habe einen Hund, Du hast Hunger).', time:'20 min' }, { id:'d4-t3', icon:'üéß', color:'bg-pink-50', desc:'Escucha un audio que use "sein" y "haben".', time:'15 min' } ] },
                { day: 5, word: 'Woher?', wordTrans: '¬øDe d√≥nde?', title: 'Preguntas (W-Fragen)', journalPrompt: 'Escribe 3 preguntas W y sus respuestas.', exampleSentence: 'Woher kommen Sie?', exampleTranslation: '¬øDe d√≥nde viene usted?', learningGoals: ["Identificar y usar las principales part√≠culas interrogativas (Wer, Was, Wo, Wie, Wann, Woher, etc.).", "Formular preguntas b√°sicas sobre informaci√≥n personal."], lessonContent: `<h3>Las Part√≠culas Interrogativas (W-Fragen)</h3><p>Las preguntas que no se responden con s√≠/no (como las de informaci√≥n personal) comienzan con una 'W'.</p><ul><li><strong>Wer?</strong> (¬øQui√©n?) Ejemplo: Wer ist das?</li><li><strong>Was?</strong> (¬øQu√©?) Ejemplo: Was machen Sie?</li><li><strong>Wo?</strong> (¬øD√≥nde?) Ejemplo: Wo wohnst du?</li><li><strong>Woher?</strong> (¬øDe d√≥nde?) Ejemplo: Woher kommen Sie?</li><li><strong>Wie?</strong> (¬øC√≥mo?) Ejemplo: Wie geht es dir?</li><li><strong>Wann?</strong> (¬øCu√°ndo?) Ejemplo: Wann beginnt der Kurs?</li></ul><h3>Estructura Clave</h3><p>La regla de oro en alem√°n es que el verbo (la acci√≥n) siempre debe ir en la <strong>segunda posici√≥n</strong> de la oraci√≥n.</p><p><strong>[W-Frage] + [Verbo conjugado] + [Sujeto/Complementos]</strong></p><p>Ejemplo: <strong>Wie</strong> <strong>hei√üen</strong> Sie? / <strong>Wo</strong> <strong>ist</strong> die Toilette?</p>`, tasks: [ { id:'d5-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende las "W-Fragen" (Wer, Was, Wo, Wie, Wann, Woher).', time:'20 min' }, { id:'d5-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe una pregunta con cada "W-Frage" (Ej: Wer bist t√∫? Wo wohnst du?).', time:'20 min' }, { id:'d5-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica preguntar y responder estas preguntas b√°sicas en voz alta.', time:'15 min' } ] },
                { day: 6, word: 'die Zahl', wordTrans: 'el N√∫mero', plural: 'die Zahlen', title: 'El Alfabeto y N√∫meros (0-20)', journalPrompt: 'Escribe tu edad y n√∫mero de tel√©fono.', exampleSentence: 'Meine Lieblingszahl ist sieben.', exampleTranslation: 'Mi n√∫mero favorito es el siete.', learningGoals: ["Reconocer y pronunciar el alfabeto alem√°n.", "Contar del 0 al 20."], lessonContent: `<h3>El Alfabeto Alem√°n (Das Alphabet)</h3><p>El alfabeto es similar al espa√±ol, pero tiene letras con di√©resis (√Ñ, √ñ, √ú) y la eszett (√ü).</p><p><strong>Puntos clave:</strong></p><ul><li>La letra V se pronuncia como "F" (Ej: Vater -> Fater).</li><li>La letra W se pronuncia como "V" (Ej: Woche -> Voche).</li><li>La letra Z se pronuncia como "Ts" (Ej: Zahl -> Tsal).</li></ul><h3>N√∫meros 0-20</h3><p>Es esencial memorizar los n√∫meros hasta el 12. A partir del 13, se forma como en ingl√©s: [Unidad] + [diez].</p><ul><li><strong>11:</strong> elf, <strong>12:</strong> zw√∂lf</li><li><strong>13:</strong> dreizehn, <strong>16:</strong> sechzehn (¬°Ojo! Pierde la 's')</li></ul>`, tasks: [ { id:'d6-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende los n√∫meros de 0 a 20.', time:'20 min' }, { id:'d6-t2', icon:'üéß', color:'bg-pink-50', desc:'Escucha una canci√≥n del alfabeto alem√°n y c√°ntala.', time:'15 min' }, { id:'d6-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica decir tu n√∫mero de tel√©fono y edad.', time:'15 min' } ] },
                { day: 7, word: 'Repaso', wordTrans: 'Revisi√≥n', plural: 'Repasos', title: 'Repaso Semana 1', journalPrompt: 'Escribe un p√°rrafo present√°ndote.', exampleSentence: 'Heute machen wir einen Repaso.', exampleTranslation: 'Hoy hacemos un repaso.', learningGoals: ["Consolidar saludos, presentaciones.", "Repasar conjugaciones de 'sein' y 'haben'.", "Practicar W-Fragen y n√∫meros b√°sicos."], lessonContent: `<p>Esta semana se centr√≥ en las bases de la comunicaci√≥n: presentarse, preguntar y responder informaci√≥n personal, y los dos verbos m√°s importantes: <strong>sein</strong> (ser/estar) y <strong>haben</strong> (tener).</p><h3>Autoevaluaci√≥n R√°pida</h3><p>Intenta conjugar 'sein' y 'haben' para 'Ich', 'Du', 'Er/Sie/Es' de memoria. Si lo logras, est√°s listo para la siguiente semana.</p>`, tasks: [ { id:'d7-t1', icon:'üìñ', color:'bg-yellow-50', desc:'Lee un di√°logo corto (A1) e identifica saludos, "sein", "haben".', time:'20 min' }, { id:'d7-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe un p√°rrafo corto (3-5 frases) present√°ndote.', time:'20 min' }, { id:'d7-t3', icon:'üß†', color:'bg-purple-50', desc:'Repasa vocabulario d√≠as 1-6 con flashcards.', time:'15 min' } ] },
                { day: 8, word: 'die Familie', wordTrans: 'la Familia', plural: 'die Familien', title: 'La Familia y Posesivos', journalPrompt: 'Describe a tu familia usando posesivos.', exampleSentence: 'Meine Familie wohnt in Spanien.', exampleTranslation: 'Mi familia vive en Espa√±a.', learningGoals: ["Nombrar a los miembros b√°sicos de la familia.", "Usar los adjetivos posesivos (mein/dein)."], lessonContent: `<h3>Mi Familia (Meine Familie)</h3><p>Vocabulario: <strong>der Vater</strong> (padre), <strong>die Mutter</strong> (madre), <strong>die Geschwister</strong> (hermanos), <strong>mein/e</strong> (mi), <strong>dein/e</strong> (tu).</p>`, tasks: [ { id:'d8-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende los miembros de la familia.', time:'20 min' }, { id:'d8-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Usa mein/meine y dein/deine en 5 frases.', time:'20 min' }, { id:'d8-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica describir a tu familia en voz alta.', time:'15 min' } ] },
                // D√≠a 9 (Corregido y Completado)
                { day: 9, word: 'der Tisch', wordTrans: 'la mesa', plural: 'die Tische', title: 'Art√≠culos: Nominativo (der, die, das)', journalPrompt: 'Escribe 3 frases describiendo objetos.', exampleSentence: 'Der Tisch ist gro√ü.', exampleTranslation: 'La mesa es grande.', learningGoals: ["Identificar los 3 art√≠culos definidos (der, die, das) en Nominativo.", "Entender el g√©nero gramatical."], lessonContent: `<h3>Los Art√≠culos Definidos</h3><p>En alem√°n, cada sustantivo tiene un g√©nero que **no** siempre coincide con el espa√±ol: <strong>Der</strong> (Masculino), <strong>Die</strong> (Femenino), <strong>Das</strong> (Neutro), <strong>Die</strong> (Plural).</p><ul><li>Aprende siempre el sustantivo con su art√≠culo: *der* Tisch (masc.), *die* Lampe (fem.), *das* Buch (neutro).</li></ul>`, tasks: [ { id:'d9-t1', icon:'üß†', color:'bg-pink-50', desc:'Gram√°tica: Repasa los art√≠culos definidos (der, die, das).', time:'20 min' }, { id:'d9-t2', icon:'üìñ', color:'bg-yellow-50', desc:'Asigna un art√≠culo a 10 objetos comunes.', time:'15 min' }, { id:'d9-t3', icon:'‚úçÔ∏è', color:'bg-orange-50', desc:'Escribe 5 frases simples usando un art√≠culo.', time:'15 min' } ] },
                { day: 10, word: 'kein', wordTrans: 'ning√∫n/a', plural: 'keine', title: 'Negaci√≥n: nicht vs. kein', journalPrompt: 'Escribe 3 frases usando "nicht" y 2 con "kein".', exampleSentence: 'Ich habe keinen Hund.', exampleTranslation: 'No tengo ning√∫n perro.', learningGoals: ["Diferenciar el uso de 'nicht' y 'kein'.", "Negar frases con verbos y sustantivos."], lessonContent: `<h3>Negaci√≥n en Alem√°n</h3><p>Se utiliza **nicht** para negar verbos, adjetivos y oraciones completas. Se utiliza **kein/keine/keinen** para negar sustantivos que no tienen art√≠culo (o tienen art√≠culo indefinido).</p><ul><li>"Ich bin **nicht** m√ºde." (No estoy cansado).</li><li>"Das ist **kein** Auto." (Esto no es un coche).</li></ul>`, tasks: [ { id:'d10-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Entiende la posici√≥n de "nicht" en la frase.', time:'20 min' }, { id:'d10-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Transforma 5 frases afirmativas en negativas.', time:'20 min' }, { id:'d10-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica decir en voz alta las negaciones.', time:'10 min' } ] },
                { day: 11, word: 'der Morgen', wordTrans: 'la ma√±ana', plural: 'die Morgen', title: 'Horarios y D√≠as', journalPrompt: 'Describe tu rutina matutina.', exampleSentence: 'Am Morgen trinke ich Kaffee.', exampleTranslation: 'Por la ma√±ana bebo caf√©.', learningGoals: ["Aprender los d√≠as de la semana y partes del d√≠a.", "Formular preguntas y respuestas sobre el tiempo."], lessonContent: `<h3>D√≠as y Momentos (Die Zeit)</h3><p>Lunes (**Montag**), Martes (**Dienstag**), Mi√©rcoles (**Mittwoch**)... La preposici√≥n m√°s com√∫n para d√≠as y momentos (excepto 'noche') es **am**.</p><ul><li>"**Am** Dienstag habe ich Deutsch."</li></ul>`, tasks: [ { id:'d11-t1', icon:'üß†', color:'bg-pink-50', desc:'Vocabulario: D√≠as de la semana y partes del d√≠a.', time:'20 min' }, { id:'d11-t2', icon:'üéß', color:'bg-purple-50', desc:'Escucha di√°logos con horarios.', time:'15 min' }, { id:'d11-t3', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe qu√© haces cada d√≠a de la semana.', time:'15 min' } ] },
                { day: 12, word: 'essen', wordTrans: 'comer', title: 'Verbos Separables', journalPrompt: 'Escribe 3 frases con verbos separables.', exampleSentence: 'Ich rufe dich an.', exampleTranslation: 'Yo te llamo (por tel√©fono).', learningGoals: ["Identificar verbos separables (anrufen, aufstehen).", "Entender la colocaci√≥n del prefijo separado."], lessonContent: `<h3>Verbos Separables (Trennbare Verben)</h3><p>Algunos verbos como **anrufen** (llamar por tel√©fono) o **aufstehen** (levantarse) se dividen en dos. El prefijo va al **final** de la oraci√≥n.</p><ul><li>Ich **rufe** meinen Freund **an**.</li></ul>`, tasks: [ { id:'d12-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Aprende 3 verbos separables y conjugarlos.', time:'20 min' }, { id:'d12-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Practica la formaci√≥n de oraciones con verbos separables.', time:'20 min' }, { id:'d12-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Intenta crear 3 frases originales.', time:'10 min' } ] },
                { day: 13, word: 'kaufen', wordTrans: 'comprar', title: 'Acusativo: der/die/das cambia a den', journalPrompt: 'Escribe 3 frases usando el Acusativo.', exampleSentence: 'Ich kaufe den Tisch.', exampleTranslation: 'Yo compro la mesa.', learningGoals: ["Entender la funci√≥n del caso Acusativo (objeto directo).", "Aplicar el cambio de 'der' a 'den'."], lessonContent: `<h3>El Caso Acusativo</h3><p>El Acusativo marca el **objeto directo** de la acci√≥n (la cosa o persona que recibe el verbo). **¬°Solo cambia el art√≠culo masculino!**</p><ul><li>Nominativo (Sujeto): **Der** Mann ist nett.</li><li>Acusativo (Objeto): Ich sehe **den** Mann.</li><li>Femenino/Neutro/Plural: **Die** Frau/ **Das** Kind/ **Die** Autos (no cambian).</li></ul>`, tasks: [ { id:'d13-t1', icon:'üß†', color:'bg-pink-50', desc:'Gram√°tica: Memoriza la tabla de art√≠culos en Acusativo.', time:'20 min' }, { id:'d13-t2', icon:'üìñ', color:'bg-yellow-50', desc:'Identifica el objeto directo en 10 oraciones.', time:'15 min' }, { id:'d13-t3', icon:'‚úçÔ∏è', color:'bg-orange-50', desc:'Escribe 4 frases con objetos masculinos en Acusativo.', time:'15 min' } ] },
                { day: 14, word: 'Repaso', wordTrans: 'Revisi√≥n', plural: 'Repasos', title: 'Repaso Semana 2', journalPrompt: 'Crea un di√°logo corto en un caf√©.', exampleSentence: 'Haben Sie einen Kaffee?', exampleTranslation: '¬øTiene usted un caf√©?', learningGoals: ["Consolidar la diferencia entre nicht y kein.", "Practicar los verbos separables.", "Reforzar el caso Acusativo."], lessonContent: `<h3>Autoevaluaci√≥n: La Negaci√≥n y el Caso</h3><p>¬øPuedes negar las siguientes frases correctamente?: 1. Das ist ein Buch. 2. Ich habe Hunger. 3. Ich rufe dich an. (Respuestas: Das ist **kein** Buch. Ich habe **keinen** Hunger. Ich rufe dich **nicht** an.)</p>`, tasks: [ { id:'d14-t1', icon:'üìñ', color:'bg-yellow-50', desc:'Revisa tus frases de negaci√≥n y Acusativo de la semana.', time:'20 min' }, { id:'d14-t2', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica la pronunciaci√≥n de verbos separables (Ej: an-ru-fen).', time:'15 min' }, { id:'d14-t3', icon:'üß†', color:'bg-purple-50', desc:'Flashcards: Art√≠culos definidos Nominativo/Acusativo.', time:'15 min' } ] },
                { day: 15, word: 'die Wohnung', wordTrans: 'el apartamento', plural: 'die Wohnungen', title: 'Vivienda y Muebles', journalPrompt: 'Describe tu habitaci√≥n.', exampleSentence: 'Ich habe eine gro√üe Wohnung.', exampleTranslation: 'Tengo un apartamento grande.', learningGoals: ["Vocabulario de la vivienda y muebles.", "Usar preposiciones simples de lugar (in, auf, unter)."], lessonContent: `<h3>Mi Casa (Mein Zuhause)</h3><p>Vocabulario: <strong>das Haus</strong> (casa), <strong>die K√ºche</strong> (cocina), <strong>das Schlafzimmer</strong> (dormitorio), <strong>der Stuhl</strong> (silla). ¬°Recuerda los art√≠culos!</p><ul><li>El verbo **wohnen** (vivir, residir) se conjuga regularmente: Ich wohne, Du wohnst...</li></ul>`, tasks: [ { id:'d15-t1', icon:'üß†', color:'bg-pink-50', desc:'Vocabulario: Aprende 10 palabras de vivienda/muebles.', time:'20 min' }, { id:'d15-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Dibuja 5 muebles y etiqueta con su art√≠culo.', time:'20 min' }, { id:'d15-t3', icon:'üéß', color:'bg-purple-50', desc:'Escucha una descripci√≥n de un apartamento (A1).', time:'10 min' } ] },
                { day: 16, word: 'die Uhr', wordTrans: 'el reloj', plural: 'die Uhren', title: 'Decir la Hora', journalPrompt: 'Escribe 3 horas diferentes en formato informal.', exampleSentence: 'Es ist halb drei.', exampleTranslation: 'Son las dos y media.', learningGoals: ["Aprender los formatos formal (oficial) e informal de la hora.", "Usar 'viertel' (cuarto) y 'halb' (media)."], lessonContent: `<h3>¬øQu√© hora es? (Wie sp√§t ist es?)</h3><p>En el formato **informal**, se usa **halb** (media) para referirse a la media hora **siguiente**. Ej: **Halb drei** (Media de tres) significa 2:30.</p><ul><li>Formato Formal: **Es ist f√ºnfzehn Uhr drei√üig.** (15:30)</li><li>Formato Informal: **Es ist halb vier.** (3:30)</li></ul>`, tasks: [ { id:'d16-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Memoriza la estructura para decir las horas.', time:'20 min' }, { id:'d16-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 horas en formato informal y formal.', time:'20 min' }, { id:'d16-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica decir las horas r√°pidamente en voz alta.', time:'10 min' } ] },
                { day: 17, word: 'der Bahnhof', wordTrans: 'la estaci√≥n de tren', plural: 'die Bahnh√∂fe', title: 'Ubicaci√≥n y Direcciones', journalPrompt: 'Escribe c√≥mo llegar a un lugar.', exampleSentence: 'Der Bahnhof ist links.', exampleTranslation: 'La estaci√≥n est√° a la izquierda.', learningGoals: ["Aprender vocabulario para pedir y dar direcciones.", "Usar preposiciones de lugar (links, rechts, geradeaus)."], lessonContent: `<h3>Preposiciones de Lugar</h3><p>Para describir la ubicaci√≥n, usamos: **links** (izquierda), **rechts** (derecha), **geradeaus** (recto). El verbo principal es **sein**.</p><ul><li>La farmacia **ist** **neben** dem Supermarkt.</li></ul>`, tasks: [ { id:'d17-t1', icon:'üß†', color:'bg-pink-50', desc:'Vocabulario: 10 palabras sobre lugares (supermercado, banco, etc.).', time:'20 min' }, { id:'d17-t2', icon:'üéß', color:'bg-purple-50', desc:'Escucha un audio pidiendo direcciones.', time:'15 min' }, { id:'d17-t3', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 3 direcciones (Ej: Gehen Sie geradeaus...).', time:'15 min' } ] },
                { day: 18, word: 'k√∂nnen', wordTrans: 'poder', title: 'Verbos Modales (k√∂nnen)', journalPrompt: 'Escribe 3 cosas que puedes hacer.', exampleSentence: 'Ich kann Deutsch sprechen.', exampleTranslation: 'Yo puedo hablar alem√°n.', learningGoals: ["Conjugar el modal 'k√∂nnen' (poder).", "Entender la estructura de la frase con verbos modales."], lessonContent: `<h3>Verbo Modal: k√∂nnen</h3><p>El verbo modal va en la **segunda posici√≥n** conjugado, y el verbo principal (infinitivo) va al **final** de la oraci√≥n.</p><div class="p-3 bg-red-50 rounded-md font-mono text-sm"><p>Ich <strong>kann</strong> (Yo puedo)</p><p>Du <strong>kannst</strong> (T√∫ puedes)</p><p>Er/Sie/Es <strong>kann</strong> (√âl/Ella/Ello puede)</p></div>`, tasks: [ { id:'d18-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Conjuga y memoriza "k√∂nnen".', time:'20 min' }, { id:'d18-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases con el modal "k√∂nnen".', time:'20 min' }, { id:'d18-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica la estructura modal en voz alta.', time:'10 min' } ] },
                { day: 19, word: 'm√ºssen', wordTrans: 'deber (obligaci√≥n)', title: 'Verbos Modales (m√ºssen)', journalPrompt: 'Escribe 3 cosas que debes hacer ma√±ana.', exampleSentence: 'Ich muss arbeiten.', exampleTranslation: 'Yo tengo que trabajar.', learningGoals: ["Conjugar el modal 'm√ºssen' (tener que).", "Expresar obligaciones y necesidades."], lessonContent: `<h3>Verbo Modal: m√ºssen</h3><p>Se usa para expresar obligaci√≥n o necesidad. La estructura es igual que con 'k√∂nnen': modal conjugado en posici√≥n 2, infinitivo al final.</p><div class="p-3 bg-red-50 rounded-md font-mono text-sm"><p>Ich <strong>muss</strong> (Yo debo/tengo que)</p><p>Du <strong>musst</strong> (T√∫ debes/tienes que)</p><p>Er/Sie/Es <strong>muss</strong> (√âl/Ella/Ello debe/tiene que)</p></div>`, tasks: [ { id:'d19-t1', icon:'üß†', color:'bg-pink-50', desc:'Gram√°tica: Conjuga y memoriza "m√ºssen".', time:'20 min' }, { id:'d19-t2', icon:'üìñ', color:'bg-yellow-50', desc:'Crea una lista de 5 obligaciones con "m√ºssen".', time:'15 min' }, { id:'d19-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Di las frases con un tono de obligaci√≥n.', time:'15 min' } ] },
                { day: 20, word: 'der Supermarkt', wordTrans: 'el supermercado', plural: 'die Superm√§rkte', title: 'Comida y Compras', journalPrompt: 'Escribe tu lista de compras semanal.', exampleSentence: 'Ich gehe in den Supermarkt.', exampleTranslation: 'Yo voy al supermercado.', learningGoals: ["Vocabulario de alimentos, bebidas y tiendas.", "Practicar frases en Acusativo al comprar."], lessonContent: `<h3>En el Supermercado (Im Supermarkt)</h3><p>Al comprar, se usa mucho el Acusativo (**Ich kaufe** [Acusativo]). Recuerda los art√≠culos: **das** Brot, **die** Milch, **der** K√§se.</p><ul><li>Para preguntar el precio: **Was kostet...?**</li></ul>`, tasks: [ { id:'d20-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Aprende 10 frutas y 10 verduras.', time:'20 min' }, { id:'d20-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe un mini-di√°logo en la caja del supermercado.', time:'20 min' }, { id:'d20-t3', icon:'üéß', color:'bg-pink-50', desc:'Escucha una conversaci√≥n sobre comida.', time:'10 min' } ] },
                { day: 21, word: 'Repaso', wordTrans: 'Revisi√≥n', plural: 'Repasos', title: 'Repaso Semana 3', journalPrompt: 'Escribe sobre tu rutina diaria usando horas y modales.', exampleSentence: 'Um sieben Uhr muss ich aufstehen.', exampleTranslation: 'A las siete tengo que levantarme.', learningGoals: ["Consolidar la hora y las direcciones.", "Repasar los modales 'k√∂nnen' y 'm√ºssen'.", "Integrar vocabulario de vivienda y compras."], lessonContent: `<h3>Integraci√≥n de Contenido</h3><p>La semana se enfoc√≥ en integrar verbos modales, la hora y el vocabulario pr√°ctico. Trata de contarle a alguien tu d√≠a (ma√±ana, tarde, noche) usando todo lo aprendido.</p>`, tasks: [ { id:'d21-t1', icon:'üìñ', color:'bg-yellow-50', desc:'Revisa tus conjugaciones de los verbos modales.', time:'20 min' }, { id:'d21-t2', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Describe la distribuci√≥n de tu casa en voz alta.', time:'15 min' }, { id:'d21-t3', icon:'üß†', color:'bg-purple-50', desc:'Cuestionario r√°pido de 10 preguntas (W-Fragen, hora, modales).', time:'15 min' } ] },
                { day: 22, word: 'die Jahreszeit', wordTrans: 'la estaci√≥n del a√±o', plural: 'die Jahreszeiten', title: 'Clima y Estaciones', journalPrompt: 'Describe el clima de tu ciudad.', exampleSentence: 'Es regnet heute.', exampleTranslation: 'Hoy est√° lloviendo.', learningGoals: ["Aprender las estaciones y el vocabulario del clima.", "Expresar el tiempo atmosf√©rico."], lessonContent: `<h3>El Clima (Das Wetter)</h3><p>Vocabulario: **der Sommer** (verano), **der Winter** (invierno). Usamos el impersonal **Es ist...** (Est√°...) o el verbo **regnen/schneien**.</p><ul><li>**Es ist kalt.** (Hace fr√≠o.)</li><li>**Es schneit.** (Est√° nevando.)</li></ul>`, tasks: [ { id:'d22-t1', icon:'üß†', color:'bg-pink-50', desc:'Vocabulario: 4 estaciones y 5 adjetivos de clima.', time:'20 min' }, { id:'d22-t2', icon:'üéß', color:'bg-purple-50', desc:'Mira un pron√≥stico del tiempo en alem√°n.', time:'15 min' }, { id:'d22-t3', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe sobre tu estaci√≥n favorita y por qu√©.', time:'15 min' } ] },
                { day: 23, word: 'm√∂chten', wordTrans: 'querr√≠a (deseo)', title: 'Verbo Modal (m√∂chten)', journalPrompt: 'Escribe 3 cosas que te gustar√≠a pedir en un restaurante.', exampleSentence: 'Ich m√∂chte einen Kaffee.', exampleTranslation: 'Yo querr√≠a un caf√©.', learningGoals: ["Conjugar el modal 'm√∂chten' (deseo cort√©s).", "Practicar el vocabulario de restaurante."], lessonContent: `<h3>Verbo Modal: m√∂chten</h3><p>Es la forma cort√©s de expresar un deseo (m√°s que 'wollen'). Se usa principalmente para pedidos.</p><div class="p-3 bg-red-50 rounded-md font-mono text-sm"><p>Ich <strong>m√∂chte</strong></p><p>Du <strong>m√∂chtest</strong></p><p>Er/Sie/Es <strong>m√∂chte</strong></p></div>`, tasks: [ { id:'d23-t1', icon:'üß†', color:'bg-purple-50', desc:'Gram√°tica: Conjuga y memoriza "m√∂chten".', time:'20 min' }, { id:'d23-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe un mini-di√°logo en un restaurante.', time:'20 min' }, { id:'d23-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica decir el pedido en voz alta.', time:'10 min' } ] },
                { day: 24, word: 'd√ºrfen', wordTrans: 'poder (permiso)', title: 'Verbo Modal (d√ºrfen)', journalPrompt: 'Escribe 3 cosas que est√° permitido hacer en un parque.', exampleSentence: 'Man darf hier rauchen.', exampleTranslation: 'Se permite fumar aqu√≠.', learningGoals: ["Conjugar el modal 'd√ºrfen' (permiso).", "Expresar prohibiciones y permisos."], lessonContent: `<h3>Verbo Modal: d√ºrfen</h3><p>Se usa para pedir o dar permiso. La negaci√≥n (**nicht d√ºrfen**) expresa una prohibici√≥n.</p><div class="p-3 bg-red-50 rounded-md font-mono text-sm"><p>Ich <strong>darf</strong> (Yo puedo/tengo permiso)</p><p>Du <strong>darfst</strong></p><p>Er/Sie/Es <strong>darf</strong></p></div>`, tasks: [ { id:'d24-t1', icon:'üß†', color:'bg-pink-50', desc:'Gram√°tica: Conjuga y memoriza "d√ºrfen".', time:'20 min' }, { id:'d24-t2', icon:'üìñ', color:'bg-yellow-50', desc:'Busca 5 se√±ales de prohibici√≥n en alem√°n.', time:'15 min' }, { id:'d24-t3', icon:'‚úçÔ∏è', color:'bg-orange-50', desc:'Escribe 3 frases de prohibici√≥n (Ej: Du darfst hier nicht parken).', time:'15 min' } ] },
                { day: 25, word: 'gern', wordTrans: 'con gusto', plural: 'gern', title: 'Expresar Gustos y Aficiones', journalPrompt: 'Escribe 3 de tus aficiones y las cosas que no te gustan.', exampleSentence: 'Ich spiele gern Fu√üball.', exampleTranslation: 'Me gusta jugar f√∫tbol.', learningGoals: ["Usar 'gern' para expresar aficiones.", "Aprender vocabulario b√°sico de aficiones."], lessonContent: `<h3>Me Gusta (Ich mag/Ich mache gern)</h3><p>Para expresar que algo te gusta hacer, usa **gern** o **nicht gern** despu√©s del verbo.</p><ul><li>Verbo: Ich **tanze** gern.</li><li>Verbo modal: Ich **m√∂chte** gern ins Kino gehen.</li></ul>`, tasks: [ { id:'d25-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: 10 verbos de aficiones (lesen, kochen, reisen).', time:'20 min' }, { id:'d25-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe 5 frases con 'gern' y 5 con 'nicht gern'.', time:'20 min' }, { id:'d25-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Pregunta a un compa√±ero (o a ti mismo) sobre gustos: Was machst du gern?', time:'10 min' } ] },
                { day: 26, word: 'die E-Mail', wordTrans: 'el correo electr√≥nico', plural: 'die E-Mails', title: 'Escribir un Correo Electr√≥nico (A1)', journalPrompt: 'Escribe un email corto a un profesor.', exampleSentence: 'Ich schreibe eine E-Mail.', exampleTranslation: 'Yo escribo un correo electr√≥nico.', learningGoals: ["Aprender las frases clave de un email A1 (saludo, motivo, despedida).", "Practicar la estructura de la oraci√≥n."], lessonContent: `<h3>Estructura del E-Mail</h3><p>Comienzo Formal: **Sehr geehrte Herr [Apellido]**, o Informal: **Liebe/r [Nombre]**.</p><ul><li>Motivo: **Ich schreibe Ihnen, weil...** (Le escribo porque...).</li><li>Despedida Formal: **Mit freundlichen Gr√º√üen** (Atentamente).</li></ul>`, tasks: [ { id:'d26-t1', icon:'üß†', color:'bg-pink-50', desc:'Vocabulario: 5 frases clave para un email.', time:'20 min' }, { id:'d26-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe un email de 5 frases pidiendo informaci√≥n.', time:'20 min' }, { id:'d26-t3', icon:'üìñ', color:'bg-purple-50', desc:'Lee 3 correos electr√≥nicos de ejemplo (A1).', time:'10 min' } ] },
                { day: 27, word: 'der Geburtstag', wordTrans: 'el cumplea√±os', plural: 'die Geburtstage', title: 'Fechas y Cumplea√±os', journalPrompt: 'Escribe la fecha de tu cumplea√±os y de Navidad.', exampleSentence: 'Mein Geburtstag ist am 14. Januar.', exampleTranslation: 'Mi cumplea√±os es el 14 de enero.', learningGoals: ["Aprender los meses del a√±o.", "Decir y preguntar fechas."], lessonContent: `<h3>Fechas y Meses (Daten und Monate)</h3><p>Para decir la fecha de un evento se usa la preposici√≥n **am** (en el d√≠a). Los meses: **Januar, Februar, M√§rz...**</p><ul><li>Mi cumplea√±os es **am** 25. Mai. (Se dice "am f√ºnfundzwanzigsten Mai").</li></ul>`, tasks: [ { id:'d27-t1', icon:'üß†', color:'bg-purple-50', desc:'Vocabulario: Meses del a√±o.', time:'20 min' }, { id:'d27-t2', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Practica decir 5 fechas importantes en voz alta.', time:'15 min' }, { id:'d27-t3', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Escribe una invitaci√≥n de cumplea√±os de 3 frases.', time:'15 min' } ] },
                { day: 28, word: 'Warum?', wordTrans: '¬øPor qu√©?', title: 'Oraciones con Porque (weil)', journalPrompt: 'Escribe 3 oraciones usando "weil".', exampleSentence: 'Ich lerne Deutsch, weil es interessant ist.', exampleTranslation: 'Aprendo alem√°n porque es interesante.', learningGoals: ["Usar la conjunci√≥n 'weil' (porque).", "Entender la estructura de la oraci√≥n subordinada con 'weil' (verbo al final)."], lessonContent: `<h3>La Conjunci√≥n Subordinada: weil</h3><p>**Weil** (porque) env√≠a el verbo conjugado al **final** de la oraci√≥n subordinada.</p><ul><li>[Oraci√≥n Principal] + **weil** + [Sujeto] + [Complementos] + **[Verbo Conjugado]**.</li><li>Ejemplo: Ich bleibe zu Hause, **weil** ich krank **bin**.</li></ul>`, tasks: [ { id:'d28-t1', icon:'üß†', color:'bg-pink-50', desc:'Gram√°tica: Identifica la posici√≥n del verbo en frases con "weil".', time:'20 min' }, { id:'d28-t2', icon:'‚úçÔ∏è', color:'bg-yellow-50', desc:'Une 5 oraciones con "weil" (Ej: Tengo hambre. Quiero comer).', time:'20 min' }, { id:'d28-t3', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Explica 3 razones de por qu√© estudias alem√°n.', time:'10 min' } ] },
                { day: 29, word: 'das Hobby', wordTrans: 'la afici√≥n', plural: 'die Hobbys', title: 'Preparaci√≥n para el A1: Temas Comunes', journalPrompt: 'Escribe un resumen de tu vida: Nombre, edad, aficiones, trabajo, familia.', exampleSentence: 'Was sind deine Hobbys?', exampleTranslation: '¬øCu√°les son tus aficiones?', learningGoals: ["Repasar todos los temas del A1 (presentaci√≥n, familia, hora, aficiones).", "Preparar la parte de expresi√≥n oral del examen A1."], lessonContent: `<h3>Resumen del Nivel A1</h3><p>El examen A1 se centra en poder manejar situaciones sencillas. Las frases con **weil** y los verbos modales son clave para dar respuestas m√°s completas.</p><ul><li>Practica la autodescripci√≥n sin notas.</li></ul>`, tasks: [ { id:'d29-t1', icon:'üìñ', color:'bg-yellow-50', desc:'Revisa tus notas del diario de los d√≠as 1-28.', time:'30 min' }, { id:'d29-t2', icon:'üó£Ô∏è', color:'bg-orange-50', desc:'Graba un audio de 2 minutos hablando de ti.', time:'20 min' }, { id:'d29-t3', icon:'üß†', color:'bg-purple-50', desc:'Repaso general de vocabulario clave.', time:'10 min' } ] },
                { day: 30, word: 'Tsch√ºss', wordTrans: 'Adi√≥s', plural: 'Tsch√ºss', title: 'Examen Final y ¬°Felicidades!', journalPrompt: 'Escribe una carta a tu futuro yo en A2.', exampleSentence: 'Auf Wiedersehen!', exampleTranslation: '¬°Adi√≥s!', learningGoals: ["Celebrar la finalizaci√≥n del plan.", "Hacer un balance del progreso y planificar el A2."], lessonContent: `<h3>¬°Felicidades por completar el plan A1!</h3><p>El d√≠a 30 es un d√≠a de celebraci√≥n y de mirar hacia adelante. Has cubierto la gram√°tica y el vocabulario esenciales del nivel A1.</p><p>Para el A2, te centrar√°s en el **Pr√§teritum** (pasado simple), el **Dativ** (dativo) y el **Perfekt** (pasado compuesto).</p>`, tasks: [ { id:'d30-t1', icon:'üèÜ', color:'bg-yellow-50', desc:'¬°Haz el examen de prueba final de A1 (b√∫scalo en l√≠nea)!', time:'60 min' }, { id:'d30-t2', icon:'ü•≥', color:'bg-pink-50', desc:'¬°Celebra tu √©xito! Ya eres A1.', time:'30 min' }, { id:'d30-t3', icon:'üöÄ', color:'bg-purple-50', desc:'Investiga los contenidos del nivel A2.', time:'15 min' } ] }
            ];
            
            // EL RESTO DE LA L√ìGICA DE TU C√ìDIGO JavaScript (Asumida como funcional)
            
            // Variables de Estado
            let currentDay = 1;
            const TOTAL_DAYS = PLAN_DIARIO.length;
            let state = loadState();
            let wordQuizData = [];
            let currentWordIndex = 0;

            // Elementos del DOM
            const $ = id => document.getElementById(id);

            const daysContainer = $('daysContainer');
            const headerDayDisplay = $('headerDayDisplay');
            const currentDayDisplay = $('currentDayDisplay');
            const progressBar = $('progressBar');
            const progressPercent = $('progressPercent');
            const prevDayBtn = $('prevDayBtn');
            const nextDayBtn = $('nextDayBtn');
            const jumpDay = $('jumpDay');
            const goDay = $('goDay');
            const resetProgressBtn = $('resetProgress');

            // Modal
            const modalBackdrop = $('modalBackdrop');
            const modalTitle = $('modalTitle');
            const preTestView = $('preTestView');
            const quizView = $('quizView');
            const answerView = $('answerView');
            const greetingView = $('greetingView');
            const reminderView = $('reminderView');
            const confidenceView = $('confidenceView');
            
            // Modal - Quiz/Answer
            const openWordOfDayCard = $('openWordOfDayCard');
            const wodWord = $('wodWord');
            const wodPlural = $('wodPlural');
            const wodTranslation = $('wodTranslation');
            const quizWordTrans = $('quizWordTrans');
            const quizInput = $('quizInput');
            const quizFeedback = $('quizFeedback');
            const checkAnswerBtn = $('checkAnswerBtn');
            const revealAnswerBtn = $('revealAnswerBtn');
            const modalMessage = $('modalMessage');
            const modalExampleSentence = $('modalExampleSentence');
            const modalExampleTranslation = $('modalExampleTranslation');
            const listenWordBtn = $('listenWordBtn');
            const listenExampleBtn = $('listenExampleBtn');
            const prevWordBtn = $('prevWord');
            const nextWordBtn = $('nextWord');
            const closeModalBtn = $('closeModal');
            
            // Modal - Reminder
            const openReminderModalBtn = $('openReminderModalBtn');
            const reminderInput = $('reminderInput');
            const addReminderBtn = $('addReminderBtn');
            const reminderList = $('reminderList');
            const closeReminderModalBtn = $('closeReminderModal');

            // Modal - Pre-Test
            const preTestContainer = $('preTestContainer');
            const preTestFeedback = $('preTestFeedback');
            const submitPreTestBtn = $('submitPreTestBtn');
            
            // Journal
            const journalDaySelect = $('journalDay');
            const journalCurrentDay = $('journalCurrentDay');
            const journalText = $('journalText');
            const saveJournalBtn = $('saveJournal');
            const exportStateBtn = $('exportState');
            const importStateBtn = $('importStateBtn');
            const importFile = $('importFile');
            const autosaveNotice = $('autosaveNotice');
            
            // Template
            const dayTemplate = $('day-template').content;
            const taskTemplate = $('task-template').content;

            // Speech Synthesis
            const synth = window.speechSynthesis;
            const germanVoice = synth.getVoices().find(voice => voice.lang.startsWith('de'));

            // --- FUNCI√ìN DE UTILIDAD ---
            function speak(text) {
                if (!synth) return;
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'de-DE';
                if (germanVoice) {
                    utterance.voice = germanVoice;
                }
                synth.speak(utterance);
            }

            function sanitize(text) {
                return text.toLowerCase().trim().replace(/√§/g, 'ae').replace(/√∂/g, 'oe').replace(/√º/g, 'ue').replace(/√ü/g, 'ss');
            }

            // --- GESTI√ìN DE ESTADO ---
            function loadState() {
                try {
                    const savedState = localStorage.getItem('germanPlanState');
                    return savedState ? JSON.parse(savedState) : {
                        currentDay: 1,
                        taskProgress: {}, // { 'd1-t1': { done: true, confidence: 3 }, ... }
                        streak: 0,
                        lastCompletedDate: null,
                        journals: {}, // { '1': 'Mi primer journal...', '2': ... }
                        reminders: [],
                        preTestScore: null,
                    };
                } catch (e) {
                    console.error("Error cargando el estado local:", e);
                    return { currentDay: 1, taskProgress: {}, streak: 0, lastCompletedDate: null, journals: {}, reminders: [], preTestScore: null };
                }
            }

            function saveState() {
                localStorage.setItem('germanPlanState', JSON.stringify(state));
            }
            
            // --- C√ÅLCULOS DE PROGRESO Y RACHA ---
            function calculateProgress() {
                let completedTasks = 0;
                let totalTasks = 0;
                PLAN_DIARIO.forEach(dayData => {
                    dayData.tasks.forEach(task => {
                        totalTasks++;
                        if (state.taskProgress[task.id] && state.taskProgress[task.id].done) {
                            completedTasks++;
                        }
                    });
                });
                const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
                progressBar.style.width = `${percentage}%`;
                progressPercent.textContent = `${percentage}%`;

                // Verificar racha
                checkStreak(completedTasks);
            }
            
            function checkStreak(totalCompletedTasks) {
                if (totalCompletedTasks === 0) {
                    state.streak = 0;
                    $('streak').textContent = `0 D√≠as üî•`;
                    return;
                }
                
                const today = new Date().toDateString();
                const yesterday = new Date(new Date().setDate(new Date().getDate() - 1)).toDateString();

                if (state.lastCompletedDate === today) {
                    // Ya se complet√≥ la tarea de hoy
                } else if (state.lastCompletedDate === yesterday) {
                    // Racha mantenida, pero solo avanzamos si hay tareas nuevas completadas hoy
                    if (didCompleteTaskToday()) {
                        state.streak++;
                        state.lastCompletedDate = today;
                    }
                } else if (didCompleteTaskToday()) {
                    // Nueva racha
                    state.streak = 1;
                    state.lastCompletedDate = today;
                } else {
                    // Racha rota, pero a√∫n no se ha hecho la tarea de hoy
                }
                
                $('streak').textContent = `${state.streak} D√≠as üî•`;
                saveState();
            }

            function didCompleteTaskToday() {
                const today = new Date().toDateString();
                return Object.values(state.taskProgress).some(
                    task => task.done && new Date(task.completedDate).toDateString() === today
                );
            }

            // --- RENDERIZADO DEL D√çA ---
            function renderDay(dayNumber) {
                const dayData = PLAN_DIARIO[dayNumber - 1];
                if (!dayData) return;

                // Actualizar estado
                currentDay = dayNumber;
                state.currentDay = dayNumber;
                saveState();

                // Actualizar encabezados
                headerDayDisplay.textContent = `D√≠a ${currentDay} / ${TOTAL_DAYS}`;
                currentDayDisplay.textContent = `D√≠a ${currentDay} / ${TOTAL_DAYS}`;
                
                // Actualizar Palabra del D√≠a
                wodWord.textContent = dayData.word;
                wodPlural.textContent = `Plural: ${dayData.plural || 'N/A'}`;
                wodTranslation.textContent = dayData.wordTrans;

                // Control de navegaci√≥n
                prevDayBtn.disabled = currentDay <= 1;
                nextDayBtn.disabled = currentDay >= TOTAL_DAYS;

                // Renderizar contenido
                daysContainer.innerHTML = '';
                const dayNode = document.importNode(dayTemplate, true);
                
                dayNode.querySelector('.day-title').textContent = `üìÖ D√≠a ${dayData.day}: ${dayData.title}`;
                dayNode.querySelector('.day-word strong').textContent = dayData.word;
                dayNode.querySelector('.lesson-content').innerHTML = dayData.lessonContent;

                const taskList = dayNode.querySelector('.task-list');
                const taskProgress = dayData.tasks.filter(t => state.taskProgress[t.id] && state.taskProgress[t.id].done).length;
                const totalTasks = dayData.tasks.length;
                
                const dayStatus = dayNode.querySelector('.day-status');
                dayStatus.innerHTML = `<span class="font-bold text-pink-600">${taskProgress}/${totalTasks}</span> Tareas (${Math.round(taskProgress/totalTasks * 100) || 0}%)`;

                dayData.tasks.forEach(task => {
                    const taskNode = document.importNode(taskTemplate, true);
                    const checkbox = taskNode.querySelector('.task-checkbox');
                    const label = taskNode.querySelector('.task-label');
                    const desc = taskNode.querySelector('.task-desc');
                    const time = taskNode.querySelector('.task-time');
                    const icon = taskNode.querySelector('.task-icon');

                    desc.textContent = task.desc;
                    time.textContent = `(${task.time})`;
                    icon.textContent = task.icon;

                    if (state.taskProgress[task.id] && state.taskProgress[task.id].done) {
                        checkbox.checked = true;
                        label.classList.add('task-done');
                    }
                    
                    checkbox.dataset.taskId = task.id;
                    checkbox.addEventListener('change', (e) => handleTaskCompletion(e.target, dayData));
                    
                    taskList.appendChild(taskNode);
                });

                // A√±adir listeners para las pesta√±as
                dayNode.querySelectorAll('.tab-button').forEach(button => {
                    button.addEventListener('click', () => handleTabSwitch(dayNode.querySelector('article'), button.dataset.tab));
                });

                // Listener para el bot√≥n del diario
                dayNode.querySelector('.journal-focus-btn').addEventListener('click', () => {
                    handleJournalFocus(dayNumber);
                });
                
                daysContainer.appendChild(dayNode);
            }
            
            function handleTabSwitch(dayElement, activeTab) {
                dayElement.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                dayElement.querySelectorAll('.tab-button').forEach(button => {
                    button.classList.remove('active');
                });
                
                dayElement.querySelector(`.${activeTab}-tab`).classList.remove('hidden');
                dayElement.querySelector(`[data-tab="${activeTab}"]`).classList.add('active');
            }

            function handleTaskCompletion(checkbox, dayData) {
                const taskId = checkbox.dataset.taskId;
                const label = checkbox.closest('.task-item').querySelector('.task-label');

                if (checkbox.checked) {
                    label.classList.add('task-done');
                    showConfidenceModal(taskId, dayData);
                } else {
                    label.classList.remove('task-done');
                    state.taskProgress[taskId] = { done: false, confidence: null, completedDate: null };
                    saveState();
                    calculateProgress();
                    // Vuelve a renderizar el d√≠a para actualizar el contador
                    renderDay(currentDay); 
                }
            }
            
            function showConfidenceModal(taskId, dayData) {
                modalTitle.textContent = "Nivel de Dominio";
                [preTestView, quizView, answerView, greetingView, reminderView].forEach(v => v.classList.add('hidden'));
                confidenceView.classList.remove('hidden');
                
                modalBackdrop.classList.add('flex');
                modalBackdrop.classList.remove('hidden');
                
                document.querySelectorAll('.confidence-btn').forEach(btn => {
                    btn.onclick = () => {
                        const confidence = parseInt(btn.dataset.level);
                        state.taskProgress[taskId] = { 
                            done: true, 
                            confidence: confidence,
                            completedDate: new Date().toISOString()
                        };
                        saveState();
                        calculateProgress();
                        closeModal();
                        renderDay(currentDay); // Para actualizar el contador
                        
                        // Lanzar confeti si es la √∫ltima tarea del d√≠a
                        const completedCount = dayData.tasks.filter(t => state.taskProgress[t.id] && state.taskProgress[t.id].done).length;
                        if (completedCount === dayData.tasks.length) {
                            launchConfetti();
                        }
                    };
                });
            }

            function launchConfetti() {
                if (typeof confetti !== 'undefined') {
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                }
            }


            // --- NAVEGACI√ìN DE D√çAS ---
            prevDayBtn.addEventListener('click', () => {
                if (currentDay > 1) {
                    renderDay(currentDay - 1);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            });

            nextDayBtn.addEventListener('click', () => {
                if (currentDay < TOTAL_DAYS) {
                    renderDay(currentDay + 1);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            });

            // --- GESTI√ìN DEL DIARIO ---
            function populateJournalSelect() {
                journalDaySelect.innerHTML = '';
                for (let i = 1; i <= TOTAL_DAYS; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `D√≠a ${i}`;
                    journalDaySelect.appendChild(option);
                }
            }

            function loadJournal(day) {
                journalText.value = state.journals[day] || (PLAN_DIARIO[day - 1] ? `// Diario del D√≠a ${day}. Tema: ${PLAN_DIARIO[day - 1].title}. Prompt: "${PLAN_DIARIO[day - 1].journalPrompt}"\n\n` : '');
                journalCurrentDay.textContent = day;
                journalDaySelect.value = day;
            }

            function saveJournal() {
                const day = journalDaySelect.value;
                state.journals[day] = journalText.value;
                saveState();
                autosaveNotice.textContent = `Guardado autom√°tico activo. (Guardado: ${new Date().toLocaleTimeString()})`;
            }
            
            function handleJournalFocus(day) {
                 loadJournal(day);
                 // Desplazar a la secci√≥n del diario
                 $('journalText').scrollIntoView({ behavior: 'smooth' });
                 journalText.focus();
            }

            journalDaySelect.addEventListener('change', (e) => {
                saveJournal(); // Guardar el diario del d√≠a anterior antes de cambiar
                loadJournal(e.target.value);
            });

            // Guardado autom√°tico simple (al escribir)
            let autosaveTimer;
            journalText.addEventListener('input', () => {
                clearTimeout(autosaveTimer);
                autosaveTimer = setTimeout(saveJournal, 1500);
            });
            saveJournalBtn.addEventListener('click', saveJournal);


            // --- GESTI√ìN DE IMPORTACI√ìN/EXPORTACI√ìN ---
            exportStateBtn.addEventListener('click', () => {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "german_plan_backup.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            });

            importStateBtn.addEventListener('click', () => {
                importFile.click();
            });

            importFile.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedState = JSON.parse(e.target.result);
                        state = importedState;
                        saveState();
                        alert('Progreso importado con √©xito. Recargando la p√°gina.');
                        window.location.reload();
                    } catch (error) {
                        alert('Error al importar el archivo. Aseg√∫rate de que sea un JSON v√°lido.');
                        console.error("Import error:", error);
                    }
                };
                reader.readAsText(file);
            });

            resetProgressBtn.addEventListener('click', () => {
                if (confirm('¬øEst√°s seguro de que quieres reiniciar TODO tu progreso (tareas, racha, diario)? Esta acci√≥n es irreversible.')) {
                    localStorage.removeItem('germanPlanState');
                    window.location.reload();
                }
            });
            
            // --- QUIZ DE PALABRAS DEL D√çA ---
            openWordOfDayCard.addEventListener('click', openQuizModal);
            
            function openQuizModal() {
                modalTitle.textContent = "Wort des Tages Quiz";
                [preTestView, answerView, greetingView, reminderView, confidenceView].forEach(v => v.classList.add('hidden'));
                quizView.classList.remove('hidden');
                
                modalBackdrop.classList.add('flex');
                modalBackdrop.classList.remove('hidden');
                
                // Preparar los datos de las 5 palabras del d√≠a
                wordQuizData = PLAN_DIARIO.slice(currentDay - 5 > 0 ? currentDay - 5 : 0, currentDay)
                                          .map(day => ({ 
                                              word: day.word, 
                                              translation: day.wordTrans,
                                              plural: day.plural,
                                              exampleSentence: day.exampleSentence,
                                              exampleTranslation: day.exampleTranslation
                                          }));
                currentWordIndex = 0;
                
                startWordQuiz();
            }
            
            function startWordQuiz() {
                if (wordQuizData.length === 0) {
                    modalTitle.textContent = "Error";
                    quizWordTrans.textContent = "No hay palabras para repasar en este d√≠a.";
                    return;
                }
                const word = wordQuizData[currentWordIndex];
                
                quizWordTrans.textContent = word.translation;
                quizInput.value = '';
                quizInput.focus();
                quizFeedback.textContent = '';
                checkAnswerBtn.classList.remove('hidden');
                revealAnswerBtn.classList.remove('hidden');
                modalTitle.textContent = `Wort des Tages Quiz (${currentWordIndex + 1} / ${wordQuizData.length})`;
            }
            
            checkAnswerBtn.addEventListener('click', checkQuizAnswer);
            quizInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') checkQuizAnswer();
            });

            function checkQuizAnswer() {
                const word = wordQuizData[currentWordIndex];
                const userAnswer = sanitize(quizInput.value);
                const correctAnswer = sanitize(word.word);
                
                if (userAnswer === correctAnswer) {
                    showAnswerView(true);
                } else {
                    quizFeedback.textContent = `Incorrecto. Intenta de nuevo o revela la respuesta.`;
                    quizInput.classList.add('shake-anim');
                    setTimeout(() => quizInput.classList.remove('shake-anim'), 300);
                }
            }

            revealAnswerBtn.addEventListener('click', () => showAnswerView(false));
            
            function showAnswerView(isCorrect) {
                const word = wordQuizData[currentWordIndex];
                
                [preTestView, quizView, greetingView, reminderView, confidenceView].forEach(v => v.classList.add('hidden'));
                answerView.classList.remove('hidden');
                
                modalTitle.textContent = "Palabra del D√≠a";
                modalMessage.innerHTML = `La respuesta correcta es: <strong class="text-xl text-pink-600">${word.word}</strong> (${word.translation}) - Plural: ${word.plural || 'N/A'}`;
                modalExampleSentence.textContent = word.exampleSentence;
                modalExampleTranslation.textContent = word.exampleTranslation;
                
                // Control de navegaci√≥n en el quiz
                prevWordBtn.disabled = currentWordIndex <= 0;
                nextWordBtn.disabled = currentWordIndex >= wordQuizData.length - 1;
                
                if (isCorrect) {
                    modalMessage.innerHTML = `¬°Correcto! ${modalMessage.innerHTML}`;
                }
            }
            
            prevWordBtn.addEventListener('click', () => {
                if (currentWordIndex > 0) {
                    currentWordIndex--;
                    startWordQuiz();
                    [quizView, answerView].forEach(v => v.classList.add('hidden'));
                    quizView.classList.remove('hidden');
                }
            });
            
            nextWordBtn.addEventListener('click', () => {
                if (currentWordIndex < wordQuizData.length - 1) {
                    currentWordIndex++;
                    startWordQuiz();
                    [quizView, answerView].forEach(v => v.classList.add('hidden'));
                    quizView.classList.remove('hidden');
                } else {
                    // Fin del quiz
                    closeModal();
                    modalBackdrop.classList.add('flex');
                    modalBackdrop.classList.remove('hidden');
                    modalTitle.textContent = "Fin del Repaso";
                    greetingView.classList.remove('hidden');
                    $('greetingMessage').textContent = `¬°Has terminado el repaso de ${wordQuizData.length} palabras! ¬°Weiter so! (¬°Sigue as√≠!)`;
                    $('closeGreetingBtn').textContent = "Cerrar";
                    $('closeGreetingBtn').onclick = closeModal;
                }
            });
            
            // Listeners de Audio
            listenWordBtn.addEventListener('click', () => speak(wordQuizData[currentWordIndex].word));
            listenExampleBtn.addEventListener('click', () => speak(wordQuizData[currentWordIndex].exampleSentence));

            // Cierre del Modal General
            function closeModal() {
                modalBackdrop.classList.add('hidden');
                modalBackdrop.classList.remove('flex');
                [preTestView, quizView, answerView, greetingView, reminderView, confidenceView].forEach(v => v.classList.add('hidden'));
                quizInput.value = '';
                quizFeedback.textContent = '';
            }

            closeModalBtn.addEventListener('click', closeModal);
            // Cierra el modal si se hace clic en el fondo
            modalBackdrop.addEventListener('click', (e) => {
                if (e.target === modalBackdrop) {
                    closeModal();
                }
            });


            // --- RECORDATORIOS ---
            openReminderModalBtn.addEventListener('click', openReminderModal);
            closeReminderModalBtn.addEventListener('click', closeModal);
            
            function openReminderModal() {
                modalTitle.textContent = "Notas y Recordatorios";
                [preTestView, quizView, answerView, greetingView, confidenceView].forEach(v => v.classList.add('hidden'));
                reminderView.classList.remove('hidden');
                modalBackdrop.classList.add('flex');
                modalBackdrop.classList.remove('hidden');
                renderReminders();
            }

            function renderReminders() {
                reminderList.innerHTML = '';
                if (state.reminders.length === 0) {
                    reminderList.innerHTML = '<li class="text-gray-500 italic text-sm">No hay notas guardadas.</li>';
                    return;
                }
                
                state.reminders.forEach((reminder, index) => {
                    const li = document.createElement('li');
                    li.classList.add('flex', 'justify-between', 'items-center', 'text-gray-700', 'p-2', 'rounded-md', 'bg-gray-50', 'text-sm');
                    li.innerHTML = `<span>${reminder}</span><button class="text-red-500 hover:text-red-700 ml-2 remove-reminder" data-index="${index}">üóëÔ∏è</button>`;
                    reminderList.appendChild(li);
                });
                
                document.querySelectorAll('.remove-reminder').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(e.target.dataset.index);
                        state.reminders.splice(index, 1);
                        saveState();
                        renderReminders();
                    });
                });
            }

            addReminderBtn.addEventListener('click', () => {
                const text = reminderInput.value.trim();
                if (text) {
                    state.reminders.push(text);
                    saveState();
                    reminderInput.value = '';
                    renderReminders();
                }
            });


            // --- PRE-TEST ---
            function renderPreTest() {
                preTestContainer.innerHTML = '';
                PRE_TEST_QUESTIONS.forEach((q, qIndex) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.classList.add('p-3', 'border', 'border-gray-200', 'rounded-lg');
                    questionDiv.innerHTML = `<p class="font-medium text-gray-800 mb-2">Q${q.id}: ${q.question}</p><div class="space-y-1"></div>`;
                    const optionsDiv = questionDiv.querySelector('div');

                    q.options.forEach((option, oIndex) => {
                        const id = `q${q.id}-o${oIndex}`;
                        optionsDiv.innerHTML += `
                            <label for="${id}" class="flex items-center space-x-2 text-sm cursor-pointer">
                                <input type="radio" id="${id}" name="question${q.id}" value="${option}" class="text-pink-600 focus:ring-pink-500">
                                <span>${option}</span>
                            </label>
                        `;
                    });
                    preTestContainer.appendChild(questionDiv);
                });
            }

            submitPreTestBtn.addEventListener('click', () => {
                let score = 0;
                let allAnswered = true;
                
                PRE_TEST_QUESTIONS.forEach(q => {
                    const selected = document.querySelector(`input[name="question${q.id}"]:checked`);
                    if (!selected) {
                        allAnswered = false;
                    } else if (selected.value === q.answer) {
                        score++;
                    }
                });

                if (!allAnswered) {
                    preTestFeedback.textContent = "Por favor, responde todas las preguntas antes de enviar.";
                    return;
                }
                
                state.preTestScore = score;
                saveState();
                
                // Determinar d√≠a de inicio
                let startDay = 1;
                let message = `Tu puntuaci√≥n es ${score} de ${PRE_TEST_QUESTIONS.length}. `;

                if (score >= 4) {
                    startDay = 8;
                    message += `¬°Excelente! Ya conoces lo b√°sico. Te recomendamos empezar en el **D√≠a ${startDay}** para un repaso r√°pido y avanzar m√°s r√°pido.`;
                } else if (score >= 2) {
                    startDay = 4;
                    message += `¬°Bien! Tienes algunos conocimientos. Te recomendamos empezar en el **D√≠a ${startDay}** para reforzar los verbos b√°sicos.`;
                } else {
                    startDay = 1;
                    message += `No te preocupes. Te recomendamos empezar en el **D√≠a ${startDay}** para construir una base s√≥lida.`;
                }
                
                // Mostrar vista de saludo/resultado
                [preTestView, quizView, answerView, reminderView, confidenceView].forEach(v => v.classList.add('hidden'));
                greetingView.classList.remove('hidden');
                modalTitle.textContent = "Resultado del Test";
                $('greetingMessage').innerHTML = message;
                $('closeGreetingBtn').textContent = "¬°Comenzar el Plan!";
                $('closeGreetingBtn').onclick = () => {
                    currentDay = startDay;
                    state.currentDay = startDay;
                    saveState();
                    closeModal();
                    renderDay(currentDay);
                    // Si se salt√≥ el d√≠a, inicializar la vista
                    if (startDay > 1) {
                         window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                };
            });


            // --- INICIALIZACI√ìN ---
            function init() {
                // 1. Inicializar selectores de d√≠as
                for (let i = 1; i <= TOTAL_DAYS; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `D√≠a ${i}: ${PLAN_DIARIO[i-1].title}`;
                    jumpDay.appendChild(option);
                }
                goDay.addEventListener('click', () => {
                    const day = parseInt(jumpDay.value);
                    if (day >= 1 && day <= TOTAL_DAYS) {
                        renderDay(day);
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                });

                // 2. Cargar y renderizar el d√≠a actual
                currentDay = state.currentDay;
                renderDay(currentDay);
                
                // 3. Inicializar progreso y racha
                calculateProgress();
                
                // 4. Inicializar diario
                populateJournalSelect();
                loadJournal(currentDay);
                
                // 5. Inicializar Pre-Test
                if (!state.preTestScore) {
                    renderPreTest();
                    modalTitle.textContent = "Bienvenido/a al Plan de Alem√°n A1";
                    modalBackdrop.classList.add('flex');
                    modalBackdrop.classList.remove('hidden');
                    preTestView.classList.remove('hidden');
                }
                
                // 6. Precargar voces
                if (synth) {
                    synth.getVoices();
                }
            }

            // Iniciar la aplicaci√≥n
            init();

        })(); 
    </script>
</body>
</html>
